<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçØ Scam Honeypot Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: #eee;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 3em;
            background: linear-gradient(45deg, #00ff88, #00d4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .header p {
            color: #aaa;
            font-size: 1.2em;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 255, 136, 0.3);
        }

        .stat-card h3 {
            color: #00ff88;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .stat-card p {
            color: #aaa;
            font-size: 1em;
        }

        /* Test Area */
        .test-area {
            background: rgba(255, 255, 255, 0.05);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .test-area h2 {
            color: #00ff88;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        textarea {
            width: 100%;
            height: 120px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid #00ff88;
            color: #eee;
            border-radius: 10px;
            font-size: 16px;
            font-family: inherit;
            margin-bottom: 15px;
            resize: vertical;
            transition: border-color 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #00d4ff;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
        }

        textarea::placeholder {
            color: #666;
        }

        /* Buttons */
        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        button {
            background: linear-gradient(45deg, #00ff88, #00d4ff);
            color: #0f0c29;
            border: none;
            padding: 15px 35px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(0, 255, 136, 0.5);
        }

        button:active {
            transform: scale(0.95);
        }

        button:disabled {
            background: #555;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #eee;
        }

        .btn-danger {
            background: linear-gradient(45deg, #ff4757, #ff6b81);
            color: white;
        }

        /* Sample Messages */
        .samples {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .sample-card {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s;
        }

        .sample-card:hover {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.1);
        }

        .sample-card h4 {
            color: #00ff88;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .sample-card p {
            color: #aaa;
            font-size: 0.85em;
            line-height: 1.4;
        }

        /* Results Area */
        .results {
            background: rgba(255, 255, 255, 0.05);
            padding: 30px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            min-height: 200px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #00ff88;
            font-size: 1.2em;
        }

        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 255, 136, 0.3);
            border-top-color: #00ff88;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Conversation Box */
        .conversation-box {
            background: rgba(0, 0, 0, 0.3);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .detection-badges {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }

        .badge-danger {
            background: linear-gradient(45deg, #ff4757, #ff6b81);
            color: white;
        }

        .badge-warning {
            background: linear-gradient(45deg, #ffa502, #ff6348);
            color: white;
        }

        .badge-info {
            background: linear-gradient(45deg, #00d4ff, #0984e3);
            color: white;
        }

        /* Messages */
        .message {
            padding: 15px 20px;
            margin: 15px 0;
            border-radius: 12px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-scammer {
            background: linear-gradient(135deg, #ff4757, #ff6b81);
            color: white;
            border-left: 4px solid #ff1744;
        }

        .message-agent {
            background: linear-gradient(135deg, #00ff88, #00d4ff);
            color: #0f0c29;
            border-left: 4px solid #00ff88;
        }

        .message strong {
            display: block;
            margin-bottom: 8px;
            font-size: 0.9em;
            opacity: 0.9;
        }

        /* Intelligence Box */
        .intel-box {
            background: linear-gradient(135deg, #ffa502, #ff6348);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
        }

        .intel-box h3 {
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .intel-category {
            margin-bottom: 15px;
        }

        .intel-category strong {
            display: block;
            margin-bottom: 8px;
            text-transform: uppercase;
            font-size: 0.85em;
            opacity: 0.9;
        }

        .intel-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 10px 15px;
            margin: 5px 0;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .intel-item::before {
            content: 'üéØ';
            font-size: 1.2em;
        }

        .no-intel {
            text-align: center;
            padding: 30px;
            color: #aaa;
            font-style: italic;
        }

        .conversation-meta {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #aaa;
            font-size: 0.9em;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-state h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }

            button {
                width: 100%;
            }
        }

        /* Animations */
        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üçØ Scam Honeypot</h1>
            <p>AI-Powered Scam Detection & Intelligence Extraction</p>
        </div>

        <!-- Statistics -->
        <div class="stats-grid" id="stats">
            <div class="stat-card">
                <h3 id="totalScams">0</h3>
                <p>Scams Detected</p>
            </div>
            <div class="stat-card">
                <h3 id="totalIntel">0</h3>
                <p>Intelligence Extracted</p>
            </div>
            <div class="stat-card">
                <h3 id="activeConvs">0</h3>
                <p>Active Conversations</p>
            </div>
            <div class="stat-card">
                <h3 id="successRate">0%</h3>
                <p>Detection Accuracy</p>
            </div>
        </div>

        <!-- Test Area -->
        <div class="test-area">
            <h2>üîç Test Scam Detection</h2>
            
            <!-- Sample Messages -->
            <div class="samples">
                <div class="sample-card" onclick="loadSample(0)">
                    <h4>üí∞ Lottery Scam</h4>
                    <p>Congratulations! You won Rs 10 lakhs in lottery. Send bank details to claim prize...</p>
                </div>
                <div class="sample-card" onclick="loadSample(1)">
                    <h4>üè¶ Banking Fraud</h4>
                    <p>Your SBI account will be blocked! Update KYC immediately by clicking this link...</p>
                </div>
                <div class="sample-card" onclick="loadSample(2)">
                    <h4>üíª Tech Support</h4>
                    <p>Your computer has virus! Call Microsoft support urgently at 9876543210...</p>
                </div>
                <div class="sample-card" onclick="loadSample(3)">
                    <h4>üì± UPI Scam</h4>
                    <p>Pay Rs 500 to verify your account. Send to scammer@paytm now or account suspended...</p>
                </div>
            </div>

            <textarea id="scamMessage" placeholder="Paste a scam message here to test the honeypot system...

Try the sample messages above or paste your own!">Congratulations! You have won Rs 10,00,000 in lottery. Please share your bank account number to claim your prize. Call 9876543210 immediately or send to winner@paytm!</textarea>
            
            <div class="button-group">
                <button onclick="testScam()" id="detectBtn">
                    üîç Detect & Engage
                </button>
                <button onclick="continueConversation()" id="continueBtn" class="btn-secondary" disabled>
                    üí¨ Continue Conversation
                </button>
                <button onclick="clearResults()" class="btn-danger">
                    üóëÔ∏è Clear
                </button>
            </div>
        </div>

        <!-- Results -->
        <div class="results" id="results">
            <div class="empty-state">
                <h3>Ready to catch scammers!</h3>
                <p>Paste a scam message above and click "Detect & Engage" to start</p>
            </div>
        </div>
    </div>


<script>
    // Configuration
    // 1. ADDED BASE_URL: This points directly to your backend server
    const BASE_URL = 'https://scam-honeypot-n8bs.onrender.com'; 
    const API_KEY = 'scam-honeypot-secret-key-12345';
    
    // Sample scam messages
    const sampleMessages = [
        "Congratulations! You have won Rs 10,00,000 in lottery draw. Please share your bank account number and IFSC code to claim your prize. Contact us immediately at 9876543210 or send payment to winner@paytm!",
        "Dear SBI Customer, Your account will be blocked due to pending KYC update. Click here immediately: fake-sbi-kyc.com/update or call 9988776655. Urgent action required within 24 hours!",
        "ALERT! Your Windows computer has been infected with dangerous virus. Call Microsoft Technical Support NOW at +91-9876543210. Do not turn off your computer. Visit: fix-windows-virus.com",
        "Your Paytm account needs verification. Pay Rs 500 processing fee to scammerUPI@paytm to unlock your account. Failure to verify will result in permanent suspension. Act now!"
    ];

    let currentConvId = null;
    let conversationHistory = [];
    let stats = {
        totalScams: 0,
        totalIntel: 0,
        activeConvs: 0
    };

    // Helper function to make API calls
    async function apiCall(endpoint, data) {
        // 2. UPDATED FETCH: Now uses the full URL like Postman does
        const response = await fetch(`${BASE_URL}/api/${endpoint}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-API-Key': API_KEY
            },
            body: JSON.stringify(data)
        });
        
        if (!response.ok) {
            const error = await response.json();
            throw new Error(error.message || 'API request failed');
        }
        
        return response.json();
    }

    // Load sample message
    function loadSample(index) {
        document.getElementById('scamMessage').value = sampleMessages[index];
    }

    // Test scam detection
    async function testScam() {
        const message = document.getElementById('scamMessage').value.trim();
        const resultsDiv = document.getElementById('results');
        const detectBtn = document.getElementById('detectBtn');
        const continueBtn = document.getElementById('continueBtn');

        if (!message) {
            alert('Please enter a message to test!');
            return;
        }

        // Show loading
        detectBtn.disabled = true;
        detectBtn.textContent = 'üîÑ Analyzing...';
        resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div><p>Analyzing message and engaging scammer...</p></div>';

        try {
            const data = await apiCall('process-message', {
                message: message,
                conversation_id: currentConvId
            });

            if (data.status === 'not_a_scam') {
                resultsDiv.innerHTML = `
                    <div class="conversation-box">
                        <div class="detection-badges">
                            <span class="badge badge-info">‚úÖ NOT A SCAM</span>
                        </div>
                        <p style="color: #aaa;">This message does not appear to be a scam. No action needed.</p>
                    </div>
                `;
                detectBtn.disabled = false;
                detectBtn.textContent = 'üîç Detect & Engage';
                return;
            }

            currentConvId = data.conversation_id;
            conversationHistory.push({
                scammer: message,
                agent: data.agent_response
            });

            displayResults(data);

            // Update stats
            stats.totalScams++;
            stats.totalIntel += countIntel(data.extracted_intel);
            stats.activeConvs = 1;
            updateStats();

            // Enable continue button
            continueBtn.disabled = false;

        } catch (error) {
            resultsDiv.innerHTML = `
                <div class="conversation-box">
                    <div class="message message-scammer">
                        <strong>‚ùå Error</strong>
                        <p>${error.message}</p>
                        <small>Check if the backend server is awake at Render.com</small>
                    </div>
                </div>
            `;
        } finally {
            detectBtn.disabled = false;
            detectBtn.textContent = 'üîç Detect & Engage';
        }
    }

    // Continue conversation
    async function continueConversation() {
        if (!currentConvId) {
            alert('No active conversation!');
            return;
        }

        const nextMessage = prompt('Enter scammer\'s next message:', 'Yes sir, how much money you want to send?');
        if (!nextMessage) return;

        const continueBtn = document.getElementById('continueBtn');
        continueBtn.disabled = true;
        continueBtn.textContent = 'üí¨ Responding...';

        try {
            const data = await apiCall('process-message', {
                message: nextMessage,
                conversation_id: currentConvId
            });
            
            conversationHistory.push({
                scammer: nextMessage,
                agent: data.agent_response
            });

            displayResults(data);

            // Update intel count
            stats.totalIntel = countIntel(data.extracted_intel);
            updateStats();

        } catch (error) {
            alert('Error: ' + error.message);
        } finally {
            continueBtn.disabled = false;
            continueBtn.textContent = 'üí¨ Continue Conversation';
        }
    }

    // Display results
    function displayResults(data) {
        const resultsDiv = document.getElementById('results');
        
        let intelHtml = '';
        const intel = data.extracted_intel;
        let hasIntel = false;

        for (let key in intel) {
            if (intel[key] && intel[key].length > 0) {
                hasIntel = true;
                const displayKey = key.replace(/_/g, ' ').toUpperCase();
                intelHtml += `
                    <div class="intel-category">
                        <strong>${displayKey}</strong>
                        ${intel[key].map(item => `<div class="intel-item">${item}</div>`).join('')}
                    </div>
                `;
            }
        }

        const conversationHtml = conversationHistory.map((turn, index) => `
            <div class="message message-scammer">
                <strong>üé£ Scammer (Turn ${index + 1}):</strong>
                ${turn.scammer}
            </div>
            <div class="message message-agent">
                <strong>ü§ñ AI Agent (Ramesh):</strong>
                ${turn.agent}
            </div>
        `).join('');

        resultsDiv.innerHTML = `
            <div class="conversation-box fade-in">
                <div class="detection-badges">
                    <span class="badge badge-danger">
                        üö® SCAM DETECTED: ${data.detection.scam_type.toUpperCase()}
                    </span>
                    <span class="badge badge-warning">
                        Confidence: ${(data.detection.confidence * 100).toFixed(0)}%
                    </span>
                    <span class="badge badge-info">
                        Turn: ${conversationHistory.length}
                    </span>
                </div>

                <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <strong style="color: #00ff88;">üí° Detection Reasoning:</strong>
                    <p style="margin-top: 8px; color: #ddd;">${data.detection.reasoning}</p>
                </div>

                ${conversationHtml}

                ${hasIntel ? `
                    <div class="intel-box">
                        <h3>üéØ Extracted Intelligence</h3>
                        ${intelHtml}
                    </div>
                ` : `
                    <div class="no-intel">
                        <p>üí≠ No sensitive information extracted yet. Continue conversation to gather more intelligence...</p>
                    </div>
                `}

                <div class="conversation-meta">
                    <p>üí¨ Conversation turns: <strong>${conversationHistory.length}</strong></p>
                    <p>üÜî Conversation ID: <code>${currentConvId}</code></p>
                </div>
            </div>
        `;
    }

    function countIntel(intel) {
        let count = 0;
        for (let key in intel) {
            if (intel[key]) {
                count += intel[key].length;
            }
        }
        return count;
    }

    function updateStats() {
        document.getElementById('totalScams').textContent = stats.totalScams;
        document.getElementById('totalIntel').textContent = stats.totalIntel;
        document.getElementById('activeConvs').textContent = stats.activeConvs;
        document.getElementById('successRate').textContent = stats.totalScams > 0 ? '100%' : '0%';
    }

    function clearResults() {
        if (confirm('Clear current conversation?')) {
            currentConvId = null;
            conversationHistory = [];
            document.getElementById('results').innerHTML = `
                <div class="empty-state">
                    <h3>Ready to catch scammers!</h3>
                    <p>Paste a scam message above and click "Detect & Engage" to start</p>
                </div>
            `;
            document.getElementById('continueBtn').disabled = true;
            document.getElementById('scamMessage').value = '';
        }
    }

    updateStats();
</script>

    
</body>
</html>
